<!DOCTYPE html>
<!-- HTML5 home page for Liberator -->
<html>
  <head>
    <meta charset="utf-8">
    <title>Liberator</title>
    <style>
      body { background: #fdfdff; margin-left: 24pt; margin-top: 24pt; color: black; font-family: Arial; font-size: 11pt }
      #title { display: none; }
      div#logo { float: left; width: 70px; border: 1px solid black; position: absolute }
      #introduction p { font-size: 120%; margin-top: 3pt; }
      #introduction p#description { font-size: 160%; margin-top: 3pt; margin-left: 0px }
      section { float: left; width: 600px; margin-left: 100px; clear: left }
      aside { position: absolute; margin-top: 100pt; float: left; width: 320px; margin-left: 720px; border: 1px solid grey; padding: 6pt; background: #cfc }
      svg { border: 0px dotted black }
      div#logo svg { border: none }
      nav { margin-left: 40pt; float: left }
      nav ul { list-style-type: none }
      nav li { display: inline; }
      dl.callouts dt { float: left; }
      dl.callouts dd { padding-bottom: 4pt; margin-left: 16pt }
      pre { background: black; margin-left: 10pt; padding: 6px; overflow: auto; border: 2px solid grey; color: lightgrey; }
      .clojure.symbol { color: #2c2; font-weight: bold }
      .clojure.keyword { color: pink; font-weight: normal }
      .clojure.string { color: orange; font-weight: normal; font-size: 80% }
    </style>  
  </head>
  <body>
    <div id="logo">
      <svg
         xmlns="http://www.w3.org/2000/svg"
         version="1.1"
         width="90"
         height="90"
         >
        <g
           transform="translate(-5,2) scale(0.5,0.5)"
           id="layer1">
          <g>
            <path d="m 20,55 0,-47 10,0 0,39 22,0 0,8 -32,0"/>
            <path d="m 61,7 32,0 0,8 -10,0 0,31 10,0 0,8 -32,0 0,-8 10,0 0,-31 -10,0 0,-8" />
            <path d="m 141,41 c 0,2 -0,4 -1,6 -1,2 -2,3 -3,4 -1,1 -3,2 -5,2 -2,0 -4,1 -6,1 l -20,0 0,-47 18,0 c 2,0 5,0 6,0 2,0 4,1 5,2 1,1 2,2 3,3 0,1 1.0898,3.25785 1.08984,5.273438 -4e-5,2.695345 -0.77347,4.96878 -2.32031,6.820312 -1.54691,1.828152 -3.92581,3.082057 -7.13672,3.761719 4.00778,0.421899 7.05465,1.617211 9.14063,3.585937 2.10933,1.96877 3.16402,4.57033 3.16406,7.804688 M 127.84933,21.11776 c -3e-5,-2.039027 -0.52737,-3.480431 -1.58203,-4.324219 -1.05472,-0.867148 -2.4844,-1.300742 -4.28907,-1.300781 l -7.34765,0 0,11.214843 7.41797,0 c 1.89841,2.9e-5 3.33981,-0.468721 4.32421,-1.40625 0.98435,-0.937469 1.47654,-2.331999 1.47657,-4.183593 m 2.84765,19.6875 c -3e-5,-1.218735 -0.19925,-2.238265 -0.59765,-3.058594 -0.39847,-0.820294 -0.93753,-1.476544 -1.61719,-1.96875 -0.65628,-0.515605 -1.42972,-0.878886 -2.32031,-1.089844 -0.86722,-0.210917 -1.78128,-0.316385 -2.74219,-0.316406 l -8.78906,0 0,13.148437 9.03515,0 c 0.93748,8e-6 1.8281,-0.10546 2.67188,-0.316406 0.86716,-0.210929 1.61716,-0.562491 2.25,-1.054687 0.65622,-0.515616 1.17184,-1.207021 1.54687,-2.074219 0.37497,-0.867176 0.56247,-1.957018 0.5625,-3.269531"
                  />
            <path
               d="m 18,113 0,-47 34,0 0,8 -24,0 0,11 22,0 0,8 -22,0 0,12 25,0 0,8 -35,0"/>
            <path
               d="m 87.736046,112.81932 -10.195313,-18.105466 -6.082031,0 0,18.105466 -10.371094,0 0,-47.425778 17.367188,0 c 6.187471,4.7e-5 10.816373,1.207077 13.886719,3.621094 3.070273,2.414103 4.605428,5.894569 4.605468,10.441406 -4e-5,1.734406 -0.246134,3.304717 -0.738281,4.710937 -0.492227,1.406278 -1.171914,2.648464 -2.039062,3.726563 -0.867225,1.054711 -1.898474,1.968773 -3.09375,2.742187 -1.195347,0.750022 -2.507845,1.335959 -3.9375,1.757813 l 12.269531,20.425778 -11.671875,0 M 86.505577,79.877917 c -3e-5,-1.195279 -0.210967,-2.20309 -0.632812,-3.023438 -0.398467,-0.820275 -0.984404,-1.476525 -1.757813,-1.96875 -0.773464,-0.515586 -1.734401,-0.878867 -2.882812,-1.089843 -1.125024,-0.234336 -2.414085,-0.351524 -3.867188,-0.351563 l -5.90625,0 0,13.21875 6.1875,0 c 3.093726,2.6e-5 5.343723,-0.574192 6.75,-1.722656 1.406221,-1.171846 2.109345,-2.859344 2.109375,-5.0625"
               id="path3002"
               style="font-size:72px;font-weight:bold;text-align:center;line-height:80.00000119%;text-anchor:middle;font-family:Liberation Mono;-inkscape-font-specification:Liberation Mono Bold" />
            <path
               d="m 142,112 -10,0 -3,-11 -16,0 -3,11 -10,0 15,-47 12,0 15,47 M 121,71 c -0,0 -0,0 -0,1 -0,0 -0,1 -0,2 -0,0 -0,1 -0,2 -0,0 -0,1 -0,2 l -3,13 11,0 -3,-13 c -0,-0 -0,-1 -0,-2 -0,-0 -0,-1 -0,-2 -0,-0 -0,-1 -0,-2 -0,-0 -0,-0 -0,-1"
               id="path3004"
               style="font-size:72px;font-weight:bold;text-align:center;line-height:80.00000119%;text-anchor:middle;font-family:Liberation Mono;-inkscape-font-specification:Liberation Mono Bold" />
            <path
               d="m 39.88839,131.00917 0,39.41015 -10.371094,0 0,-39.41015 -14.273438,0 0,-8.01563 38.917969,0 0,8.01563 -14.273437,0"
               id="path3006"
               style="font-size:72px;font-weight:bold;text-align:center;line-height:80.00000119%;text-anchor:middle;font-family:Liberation Mono;-inkscape-font-specification:Liberation Mono Bold" />
            <path
               d="m 96.946983,146.54823 c -4e-5,8.08595 -1.640664,14.20313 -4.921875,18.35156 -3.281282,4.14844 -7.992215,6.22266 -14.132812,6.22266 -6.140641,0 -10.863292,-2.07422 -14.167969,-6.22266 -3.281254,-4.14843 -4.921877,-10.26561 -4.921875,-18.35156 -2e-6,-8.08591 1.640621,-14.15621 4.921875,-18.21094 3.304677,-4.05464 8.027328,-6.08198 14.167969,-6.08203 6.140597,5e-5 10.85153,2.02739 14.132812,6.08203 3.281211,4.05473 4.921835,10.12503 4.921875,18.21094 m -10.511718,0 c -3.1e-5,-5.46091 -0.714874,-9.51559 -2.144532,-12.16406 -1.429714,-2.6484 -3.562524,-3.97262 -6.398437,-3.97266 -2.835956,4e-5 -4.980486,1.3477 -6.433594,4.04297 -1.429701,2.67191 -2.144544,6.70315 -2.144531,12.09375 -1.3e-5,5.39064 0.71483,9.48048 2.144531,12.26953 1.453108,2.76564 3.597638,4.14845 6.433594,4.14844 2.835913,1e-5 4.968723,-1.3828 6.398437,-4.14844 1.429658,-2.78905 2.144501,-6.87889 2.144532,-12.26953"
               id="path3008"
               style="font-size:72px;font-weight:bold;text-align:center;line-height:80.00000119%;text-anchor:middle;font-family:Liberation Mono;-inkscape-font-specification:Liberation Mono Bold" />
            <path
               d="m 130.90792,170.41932 -10.19531,-18.10546 -6.08203,0 0,18.10546 -10.3711,0 0,-47.42578 17.36719,0 c 6.18747,5e-5 10.81637,1.20708 13.88672,3.6211 3.07027,2.4141 4.60543,5.89457 4.60547,10.4414 -4e-5,1.73441 -0.24614,3.30472 -0.73828,4.71094 -0.49223,1.40628 -1.17192,2.64846 -2.03907,3.72656 -0.86722,1.05471 -1.89847,1.96878 -3.09375,2.74219 -1.19534,0.75002 -2.50784,1.33596 -3.9375,1.75781 l 12.26954,20.42578 -11.67188,0 m -1.23047,-32.9414 c -3e-5,-1.19528 -0.21097,-2.20309 -0.63281,-3.02344 -0.39847,-0.82028 -0.9844,-1.47652 -1.75781,-1.96875 -0.77347,-0.51559 -1.7344,-0.87887 -2.88282,-1.08984 -1.12502,-0.23434 -2.41408,-0.35153 -3.86718,-0.35157 l -5.90625,0 0,13.21875 6.1875,0 c 3.09372,3e-5 5.34372,-0.57419 6.75,-1.72265 1.40622,-1.17185 2.10934,-2.85935 2.10937,-5.0625"
               id="path3010"
               style="font-size:72px;font-weight:bold;text-align:center;line-height:80.00000119%;text-anchor:middle;font-family:Liberation Mono;-inkscape-font-specification:Liberation Mono Bold" />
          </g>
        </g>
      </svg>
    </div>

    <section id="introduction">
      <h1 id="title">Liberator</h1>

      <p id="description">Liberator is a free, open-source web library for the Clojure programming language with an emphasis on <abbr title="Representational State Transfer">REST</abbr>. 
      </p>

      <p style="display: none">Most web server APIs ask the application developer to implement
        much of the HTTP specification, such as providing the proper
        response status codes, performing content negotiation and setting
        response headers correctly. Liberator is different and
        automatically determines these leaving the developer to focus on
        formatting the response body (the page, document, data) to return
        to the client.</p>
    </section>

    <nav>
      <ul>
        <li><a href="#download">Download</a></li>
        <li><a href="http://github.com/clojure-liberator/liberator">GitHub</a></li>
        <li><a href="#faq">FAQ</a></li>
      </ul>
    </nav>

    <section>
      <h2>What it is</h2>
      <p>
        Liberator is a Clojure library that helps you expose your data
        as REST resources while automatically complying with all the
        relevant requirements of HTTP specification (RFC-2616). Your
        resources will automatically gain useful HTTP features, such as
        cacheing and content negotiation.
      </p>
    </section>

    <section>
      <h2>Where it fits</h2>

      <p>
        Liberator is not a full-featured web framework like
      <a href="http://www.webnoir.org">Noir</a>. Rather, Liberator forms part of a composition of other components. So be prepared to ...</p>
      <ul>
        <li>Add a routing library, like <a href="#">Compojure</a> or <a href="#">Moustache</a></li>
        <li>Add a presentation library, like <a href="#">Hiccup</a></li>
        <li>Add some miscellaneous Ring middleware</li>
      </ul>

      <p>If you are familiar with Ring, Liberator <dfn>resources</dfn>
        are Ring handlers. A Ring handler is a Clojure function that
        takes a map as an argument (representing the web request) and
        returns another map representing the web response.</p>
      
      <p>You connect a Liberator resource to a route. For example,
      if you use Compojure as your routing library, you would connect things like this :-</p>

      <pre><code>(<span class="clojure symbol">ns</span> com.acme
  (<span class="clojure symbol">require</span> 
    [compojure.core <span class="clojure keyword">:as</span> compojure]
    [liberator.core <span class="clojure keyword">:as</span> liberator]))

(<span class="clojure symbol">compojure/ANY</span> <span class="clojure string">"/products/:sku"</span> [sku]
  (<span class="clojure symbol">liberator/resource</span> &#9312;)
</code></pre>

        <dl class="callouts">
          <dt>&#9312;</dt>
          <dd>The Liberator <code>resource</code> function takes an even
      number of arguments, each pair is a keyword (indicating the
      argument name) and the argument value. There are over 50 different
      arguments you can give to this function, all of which will be
      explained later.</dd>
        </dl>

      <p>Now if we sent a web request to the server with the path <code>/products/54354</code> it would be routed to our Liberator resource.</p>

      <p>This is how it all fits together :-</p>

      <svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" version="1.1" width="600" height="180">
        <defs>
          <style type="text/css">
            <![CDATA[
      text {
        font-size: 9pt;
        font-family: Arial;
      }
    ]]>
          </style>
          <marker id="arrowhead"
                  viewBox="0 0 10 10" refX="5" refY="5" 
                  markerUnits="strokeWidth"
                  markerWidth="4" markerHeight="3" fill="darkred"
                  stroke="black"
                  orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z" />
          </marker>
          <linearGradient id="clojure">
            <stop offset="5%" stop-color="#4E8" />
            <stop offset="95%" stop-color="#4EC" />
          </linearGradient>
          <linearGradient id="liberator">
            <stop offset="5%" stop-color="#F4F" />
            <stop offset="95%" stop-color="#F8F" />
          </linearGradient>
        </defs>

        <g transform="translate(30,20)">
          <rect x="0" y="0" width="120" height="140" fill="grey" opacity="0.5" stroke="black" stroke-width="2"/>
          <text x="60" y="60" text-anchor="middle" dominant-baseline="central">Browser or other</text>
          <text x="60" y="80" text-anchor="middle" dominant-baseline="central">HTTP user-agent</text>
        </g>

        <g transform="translate(275,20)">
          <rect x="0" y="0" width="100" height="140" fill="red" opacity="0.5" stroke="black" stroke-width="2"/>
          <text x="50" y="50" text-anchor="middle" dominant-baseline="central">Java-based</text>
          <text x="50" y="70" text-anchor="middle" dominant-baseline="central">web server</text>
          <text x="50" y="90" text-anchor="middle" dominant-baseline="central">(eg. Jetty)</text>
        </g>

        <a xlink:href="http://google.com?q=clojure+ring">
          <g transform="translate(375,160) rotate(-90)">
            <rect x="0" y="0" width="140" height="30" fill="url(#clojure)" opacity="0.5" stroke="black" stroke-width="2"/>
            <text x="70" y="15" text-decoration="underline" text-anchor="middle" dominant-baseline="central" fill="blue">Ring interface</text>
          </g>
        </a>

        <g transform="translate(405,160) rotate(-90)">
          <rect x="0" y="0" width="140" height="40" fill="url(#clojure)" opacity="0.5" stroke="black" stroke-width="2"/>
          <text x="70" y="12" text-anchor="middle" dominant-baseline="central">Ring-middleware</text>
          <text x="70" y="28" text-anchor="middle" dominant-baseline="central">and routing</text>
        </g>

        <g transform="translate(450,160) rotate(-90)">
<!--          <rect x="0" y="0" width="140" height="55" fill="green" opacity="0.2" stroke="black" stroke-width="2"/> -->
          <path d="M0,50 h20 v10 h20 v-10 h20 v10 h20 v-10 h20 v10 h20 v-10 h20 v-55 h-140 z" stroke-width="2" stroke="black" fill="url(#liberator)" opacity="0.5"/>
          <text x="70" y="20"><tspan text-anchor="middle"  dominant-baseline="central" font-size="12pt" font-weight="bold">Liberator</tspan></text>
        </g>

        <g transform="translate(515,160) rotate(-90)">
<!--          <rect x="0" y="0" width="140" height="40" fill="green" opacity="0.2" stroke="black" stroke-width="2"/>-->
          <path d="M0,65 v-80 h20 v10 h20 v-10 h20 v10 h20 v-10 h20 v10 h20 v-10 h20 v80z" stroke-width="2" stroke="black" fill="url(#clojure)" opacity="0.5"/>
          <text x="70" y="20"><tspan text-anchor="middle"  dominant-baseline="central" font-size="12pt" font-weight="bold" fill="green">Your code</tspan></text>
        </g>

        <path id="request-response" d="M150,30 h400 a 60,20 270 0,1 0,120 h-390" stroke="darkred" opacity="0.5" stroke-width="5px" fill="none" marker-end="url(#arrowhead)"/>

        <circle cx="0" cy="0" r="4" fill="white">
          <desc>This is the 'pulse' that follows the request-response path to indicate the order that events happen. Not that useful but makes things a bit more obvious.</desc>
          <animateMotion dur="2s" repeatCount="2" rotate="auto">
            <mpath xlink:href="#request-response"/>
          </animateMotion>
        </circle>

      </svg>

      <p>(If you need more information about adding the web server component, see the Ring documentation <a href="#">here</a>).</p>

    </section>

    <aside>
      <h2>Why Clojure?</h2>
      <p>
        In the REST architectural style, data is organized into a set of
        resources. The state of a particular resource can be communicated over the web in some representation of
        that state. 
      </p>
      <p>
        Clojure is an ideal implementation language for this architecture.
      </p>
      <ol>
        <li>State in Clojure is contained in data structures such as
        maps, sets and lists. Functions to represent those data
        structures in formats such as JSON already exist. Compare this
        with object-oriented languages such as Java where state is
        encapsulated within custom objects and where the external
        representation of this state is not something that is always
        considered up-front.</li>
        <li>
          Clojure's data structures employ structural sharing which
          enables efficient software transaction memory (STM). This
          means that state can be modified by one thread, while being in
          the process of being represented by another, without resorting
          to locks.
        </li>
      </ol>
    </aside>

    <section>
      <h2>How it works</h2>

      <p>Liberator works by using a <b>decision tree</b> to determine how to
      properly handle the request.</p>

      <p>Every decision is made by a <dfn>decision function</dfn>. The
      diagram below illustrates how the outcomes of decision functions
      determine the response status and the <dfn>handler function</dfn>
      that will produce the response.</p>

      <svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" version="1.1" width="600" height="330">
        <defs>
          <style type="text/css">
            <![CDATA[
      text {
        font-size: 9pt;
        font-family: Arial;
      }
    ]]>
          </style>
          <g id="handler">
            <rect y="-15" width="180" height="30" stroke="black" stroke-width="1px" fill="#acccff"/>
            <path d="M 10,-15 l 0,30 M 170,-15 l 0,30" stroke="black"/>
          </g>

          <g id="decision">
            <path d="M 0,-20 l 20,20 -20,20 -20,-20 Z" stroke-width="2px" stroke="black" fill="none"/>
          </g>

          <g id="entry">
            <rect x="0" y="0" width="240" height="20" stroke="#c0c0c0" stroke-width="1" fill="none"/>
            <path d="M70,0 v20" stroke="#c0c0c0" stroke-width="1"/>
          </g>

          <marker id="darkorange-marker"
                  viewBox="0 0 10 10" refX="5" refY="5" 
                  markerUnits="strokeWidth"
                  markerWidth="4" markerHeight="3" fill="darkorange"
                  orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z" />
          </marker>

          <marker id="darkblue-marker"
                  viewBox="0 0 10 10" refX="5" refY="5" 
                  markerUnits="strokeWidth"
                  markerWidth="4" markerHeight="3" fill="purple"
                  orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z" />
          </marker>
          <marker id="darkgreen-marker"
                  viewBox="0 0 10 10" refX="5" refY="5" 
                  markerUnits="strokeWidth"
                  markerWidth="4" markerHeight="3" fill="darkgreen"
                  orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z" />
          </marker>
          <marker id="grey-marker"
                  viewBox="0 0 10 10" refX="5" refY="5" 
                  markerUnits="strokeWidth"
                  markerWidth="4" markerHeight="3" fill="grey"
                  orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z" />
          </marker>

        </defs>

        <g transform="translate(135,55)">

          <path d="M 0,-50 v 25" stroke-width="3px" stroke="purple" marker-end="url(#darkblue-marker)"/>

          <text x="-15" y="-40">
            <tspan text-anchor="end" dominant-baseline="central" 
                   font-style="italic">START</tspan>
          </text>

          <g transform="translate(0,0)">
            <text x="-25" y="0">
              <tspan text-anchor="end" dominant-baseline="central" 
                     font-style="italic">:service-available?</tspan>
            </text>
            <text x="-25" y="15" visibility="hidden">
              <tspan text-anchor="end" dominant-baseline="central" 
                     font-style="italic">TRUE</tspan>
              
              <set attributeName="visibility" to="visible" begin="0.2s" dur="indefinite"/>
            </text>

            <g transform="rotate(45)">
              <use id="s1" x="0" y="0" xlink:href="#decision"/>
              <path d="M 20,0 h 15" stroke-width="3px" stroke="grey" marker-end="url(#grey-marker)"/>
              <animateTransform id="anim1"
                                attributeName="transform" 
                                attributeType="XML"
                                type="rotate" from="45" to="90"
                                begin="0s" dur="0.4s" fill="freeze" />
            </g>

            <g transform="translate(40,0)">
              <text x="5" y="0"><tspan text-anchor="start" text-anchor="start" dominant-baseline="middle" font-style="italic">:handle-service-not-available</tspan></text>

              <g transform="translate(175,-20)">
                <use x="0" y="0" xlink:href="#entry"/>
                <text x="5" y="10" dominant-baseline="central" font-style="italic">:status</text>
                <text x="75" y="10" dominant-baseline="central">503</text>
                <use x="0" y="20" xlink:href="#entry"/>
                <text x="5" y="30" dominant-baseline="central" font-style="italic">:message</text>
                <text x="75" y="30" dominant-baseline="central">"Service unavailable."</text>
              </g>
            </g>
          </g>

          <g transform="translate(0,60)">

            <text x="-25" y="0"><tspan text-anchor="end" font-style="italic" dominant-baseline="central">:authorized?</tspan></text>

            <text x="-25" y="15" visibility="hidden">
              <tspan text-anchor="end" dominant-baseline="central" 
                     font-style="italic">TRUE</tspan>
              <set attributeName="visibility" to="visible" begin="0.4s" dur="indefinite"/>
            </text>


            <g transform="rotate(45)">
              <use id="s2" x="0" y="0" xlink:href="#decision"/>
              <path d="M 20,0 h 15" stroke-width="3px" stroke="grey" marker-end="url(#grey-marker)"/>
              <animateTransform id="anim1"
                                attributeName="transform" 
                                attributeType="XML"
                                type="rotate" from="45" to="90"
                                begin="0.15s" dur="0.4s" fill="freeze" />
            </g>

            <g transform="translate(40,0)">
              <text x="5" y="0"><tspan font-style="italic" dominant-baseline="middle" text-anchor="start">:handle-unauthorized</tspan></text>

              <g transform="translate(135,-20)">
                <use x="0" y="0" xlink:href="#entry"/>
                <text x="5" y="10" dominant-baseline="central" font-style="italic">:status</text>
                <text x="75" y="10" dominant-baseline="central">401</text>
                <use x="0" y="20" xlink:href="#entry"/>
                <text x="5" y="30" dominant-baseline="central" font-style="italic">:message</text>
                <text x="75" y="30" dominant-baseline="central">"Not authorized."</text>
              </g>
            </g>

            <!--            <path d="M 0,20 v 15" stroke-width="3px" stroke="darkgreen" marker-end="url(#darkgreen-marker)"/> -->
            
          </g>

          <g transform="translate(0,120)">

            <text x="-25" y="0" text-anchor="end" font-style="italic" dominant-baseline="central">:valid-entity-length?</text>
            <text x="-25" y="15" visibility="hidden">
              <tspan text-anchor="end" dominant-baseline="central" 
                     font-style="italic">TRUE</tspan>
              <set attributeName="visibility" to="visible" begin="0.6s" dur="indefinite"/>
            </text>


            <g transform="rotate(45)">
              <use x="0" y="0" xlink:href="#decision"/>
              <path d="M 20,0 h 15" stroke-width="3px" stroke="grey" marker-end="url(#grey-marker)"/>
              <animateTransform id="anim1"
                                attributeName="transform" 
                                attributeType="XML"
                                type="rotate" from="45" to="90"
                                begin="0.3s" dur="0.4s" fill="freeze" />
            </g>

            <g transform="translate(40,0)">
              <text x="5" y="0"><tspan font-style="italic" dominant-baseline="middle" text-anchor="start">:handle-request-entity-too-large</tspan></text>

              <g transform="translate(185,-20)">
                <use x="0" y="0" xlink:href="#entry"/>
                <text x="5" y="10" dominant-baseline="central" font-style="italic">:status</text>
                <text x="75" y="10" dominant-baseline="central">413</text>
                <use x="0" y="20" xlink:href="#entry"/>
                <text x="5" y="30" dominant-baseline="central" font-style="italic">:message</text>
                <text x="75" y="30" dominant-baseline="central">"Request Entity Too Large."</text>
              </g>
            </g>
          </g>

          <g transform="translate(0,180)">

            <path d="M 40,0 l30,30 h365 v-60 h-365 z" stroke-width="2px" stroke="purple" fill="none" opacity="0">
              <animate attributeType="CSS" attributeName="opacity" 
                         from="0" to="0.8" begin="0.8s" dur="0.2s" fill="freeze"  />
              <desc>Highlighting the successful result</desc>
            </path>

            <text x="-25" y="0"><tspan text-anchor="end" font-style="italic" dominant-baseline="central">:resource-exists?</tspan><tspan>&#9312;</tspan></text>
            <text x="-25" y="15" visibility="hidden">
              <tspan text-anchor="end" dominant-baseline="central" 
                     font-style="italic">FALSE</tspan>
              <set attributeName="visibility" to="visible" begin="0.8s" dur="indefinite"/>
            </text>

            <g transform="rotate(45)">
              <use x="0" y="0" xlink:href="#decision"/>
              <path d="M 20,0 h 15" stroke-width="3px" stroke="grey" marker-end="url(#grey-marker)"/>
              <animateTransform 
                 attributeName="transform" 
                 attributeType="XML"
                 type="rotate" from="45" to="0"
                 begin="0.45s" dur="0.4s" fill="freeze" />
            </g>

            <g transform="translate(40,0)">
              <text x="15" y="0"><tspan font-style="italic" dominant-baseline="middle" text-anchor="start">:handle-not-found</tspan><tspan>&#9313;</tspan></text>

              <g transform="translate(145,-20)">
                <use x="0" y="0" xlink:href="#entry"/>
                <text x="5" y="10" dominant-baseline="central" font-style="italic">:status</text>
                <text x="75" y="10" dominant-baseline="central">404</text>
                <use x="0" y="20" xlink:href="#entry"/>
                <text x="5" y="30" dominant-baseline="central" font-style="italic">:message</text>
                <text x="75" y="30" dominant-baseline="central">"Not Found."</text>
              </g>
            </g>
          </g>

          <g transform="translate(-30,240)">
            <text x="5" y="0"><tspan font-style="italic" dominant-baseline="middle" text-anchor="start">:handle-ok</tspan></text>

            <g transform="translate(75,-20)">
              <use x="0" y="0" xlink:href="#entry"/>
              <text x="5" y="10" dominant-baseline="central" font-style="italic">:status</text>
              <text x="75" y="10" dominant-baseline="central">200</text>
              <use x="0" y="20" xlink:href="#entry"/>
              <text x="5" y="30" dominant-baseline="central" font-style="italic">:message</text>
              <text x="75" y="30" dominant-baseline="central">"OK."</text>
            </g>
          </g>
        </g>

      </svg>

      <dl class="callouts">
        <dt>&#9312;</dt>
        <dd>This is a <em>decision function</em>.</dd>
        <dt>&#9313;</dt>
        <dd>This is a <em>handler function</em>.</dd>
      </dl>

      <p>As a developer you can specify <b>replacements</b> to both these types of function.</p>

      <p>For example, suppose we want to override the default 404
      message. We can provide a replacement to
      the <em>:handle-not-found</em> handler function when we define the resource, like this:</p>

      <pre><code>(<span class="clojure symbol">liberator/resource</span>
  <span class="clojure keyword">:handle-not-found</span> (<span class="clojure symbol">fn</span>&#9312; [ctx&#9313;] <span class="clojure string">"Oops, we didn't find anything!"</span>&#9314;))</code></pre>
      
      <dl class="callouts">
        <dt>&#9312;</dt>
        <dd>We are providing a replacement function, but we could just as easily specify the string value in this case. Constant values can be used in place of functions where appropriate.</dd> 
       <dt>&#9313;</dt>
        <dd>This is the Liberator <em>context argument</em>. We'll come to this shortly.</dd>
        <dt>&#9314;</dt>
        <dd>We just returned a string here. Liberator is smart enough to turn this into a proper Ring response. 
      </dl>

      <p>So the value which will be returned from the resource will be something like this :-</p>

      <pre><code>{:status 404
 :body "Oops, we didn't find anything!"}</code></pre>

      <p>This will be processed by Ring to generate the final HTTP response.</p>

    </section>

    <section>
      <h2>Replacing functions<h2>
      <h3>The context argument</h3>
      <p>
        The context argument is provided as a single argument to all
        replacement functions. It is a map of 5 entries.
      </p>
      <table>
        <thead>
          <tr><td>Keyword</td><td>Description</td></tr>
        </thead>
        <tbody>
          <tr>
            <td>:request</td>
            <td>The original Ring request</td>
          </tr>
          <tr>
            <td>:resource</td>
            <td>The resource map that defines the Liberator resource</td>
          </tr>
          <tr>
            <td>:representation</td>
            <td>This is a map containing the results of content negotiation. It contains 4 possible values.
              <ul>
                <li>:media-type</li>
                <li>:language</li>
                <li>:charset</li>
                <li>:encoding</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>:status</td>
            <td>The response status code</td>
          </tr>
          <tr>
            <td>:message</td>
            <td>The default status message that usually accompanies the status code</td>
          </tr>
        </tbody>
      </table>
        
      <h3>The return value</h3>

      <p>For decision functions you usually return a boolean. If you
      return a map, this will get merged into the context given to
      future functions. Returning a map implies a true result, so if you
      want to return a false result but also specify a map you can do
      this by returning a vector pair containing the map, ie. [false
      {}] </p>

      <p>For handler functions you have more flexibility. If you return
      a map, it will be treated as a Ring response map. Anything else
      will be treated as the :body value of a Ring reponse map, and the
      rest of the details will be added by Liberator. It is possible in
      this way to override the status code if necessary. Only do this if
      you know what you're doing, but if you're sure Liberator won't
      stand in your way.</p>

      <h3>Function reference</h3>
      <p>TODO: A table of all the functions that can be replaced.</p>
      <p>TODO: A diagram showing all the parts of the full decision tree.</p>

    </section>

    <section id="running-the-examples">
      <h2>Running the examples</h2>
      <p>A set of examples is included. If you want to see the examples in a browser, run</p>
      <p><kbd>lein examples</kbd></p>
      <p>This will start a web server on port 8000 (but you can specify a alternative port with an argument, eg. <kbd>lein examples 8001</kbd>). Alternatively you can run the web server with <kbd>lein ring server</kbd>).</p>
    </section>

    <section>
      <a name="faq"/>
      <h2>F.A.Q.</h2>
      <dl>
        <dt>Why isn't Liberator simply a set of Ring middleware?</dt>
        <dd>Answer</dd>
      </dl>
    </section>

  </body>
</html>

